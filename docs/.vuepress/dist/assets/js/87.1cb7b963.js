(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{410:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"p8、springboot-整合-druid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#p8、springboot-整合-druid"}},[t._v("#")]),t._v(" P8、SpringBoot 整合 Druid")]),t._v(" "),a("h3",{attrs:{id:"_8-1、druid-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1、druid-简介"}},[t._v("#")]),t._v(" 8.1、Druid 简介")]),t._v(" "),a("blockquote",[a("p",[t._v("Java 程序很大一部分要操作数据库，为了提高性能操作数据库的时候，又不得不使用数据库连接池。")]),t._v(" "),a("p",[t._v("Druid 是阿里巴巴开源平台上一个数据库连接池实现，结合了 C3P0、DBCP 等 DB 池的优点，同时加入了日志监控。")]),t._v(" "),a("p",[t._v("Druid 可以很好的监控 DB 池连接和 SQL 的执行情况，天生就是针对监控而生的 DB 连接池。")]),t._v(" "),a("p",[t._v("Druid 已经在阿里巴巴部署了超过 600 个应用，经过一年多生产环境大规模部署的严苛考验。")]),t._v(" "),a("p",[t._v("Spring Boot 2.0 以上默认使用 Hikari 数据源，可以说 Hikari 与 Driud 都是当前 Java Web"),a("br"),t._v("\n上最优秀的数据源，我们来重点介绍 Spring Boot 如何集成 Druid 数据源，如何实现数据库监控。")]),t._v(" "),a("p",[t._v("Github 地址：https://github.com/alibaba/druid/")])]),t._v(" "),a("p",[a("strong",[t._v("com.alibaba.druid.pool.DruidDataSource 基本配置参数如下：")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("配置")]),a("th",[t._v("缺省值")]),a("th",[t._v("说明")])])]),a("tbody",[a("tr",[a("td",[t._v("name")]),a("td"),a("td",[t._v("配置这个属性的意义在于，如果存在多个数据源，监控的时候可以通过名字来区分开来。 如果没有配置，将会生成一个名字，格式是：“DataSource-” + System.identityHashCode(this). 另外配置此属性至少在 1.0.5 版本中是不起作用的，强行设置 name 会出错 "),a("a",{attrs:{href:"http://blog.csdn.net/lanmo555/article/details/41248763"}},[t._v("详情 - 点此处")]),t._v("。")])]),a("tr",[a("td",[t._v("url")]),a("td"),a("td",[t._v("连接数据库的 url，不同数据库不一样。例如： mysql : jdbc:mysql://10.20.153.104:3306/druid2 oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto")])]),a("tr",[a("td",[t._v("username")]),a("td"),a("td",[t._v("连接数据库的用户名")])]),a("tr",[a("td",[t._v("password")]),a("td"),a("td",[t._v("连接数据库的密码。如果你不希望密码直接写在配置文件中，可以使用 ConfigFilter。详细看这里：https://github.com/alibaba/druid/wiki / 使用 ConfigFilter")])]),a("tr",[a("td",[t._v("driverClassName")]),a("td",[t._v("根据 url 自动识别")]),a("td",[t._v("这一项可配可不配，如果不配置 druid 会根据 url 自动识别 dbType，然后选择相应的 driverClassName")])]),a("tr",[a("td",[t._v("initialSize")]),a("td",[t._v("0")]),a("td",[t._v("初始化时建立物理连接的个数。初始化发生在显示调用 init 方法，或者第一次 getConnection 时")])]),a("tr",[a("td",[t._v("maxActive")]),a("td",[t._v("8")]),a("td",[t._v("最大连接池数量")])]),a("tr",[a("td",[t._v("maxIdle")]),a("td",[t._v("8")]),a("td",[t._v("已经不再使用，配置了也没效果")])]),a("tr",[a("td",[t._v("minIdle")]),a("td"),a("td",[t._v("最小连接池数量")])]),a("tr",[a("td",[t._v("maxWait")]),a("td"),a("td",[t._v("获取连接时最大等待时间，单位毫秒。配置了 maxWait 之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置 useUnfairLock 属性为 true 使用非公平锁。")])]),a("tr",[a("td",[t._v("poolPreparedStatements")]),a("td",[t._v("false")]),a("td",[t._v("是否缓存 preparedStatement，也就是 PSCache。PSCache 对支持游标的数据库性能提升巨大，比如说 oracle。在 mysql 下建议关闭。")])]),a("tr",[a("td",[t._v("maxOpenPreparedStatements")]),a("td",[t._v("-1")]),a("td",[t._v("要启用 PSCache，必须配置大于 0，当大于 0 时，poolPreparedStatements 自动触发修改为 true。在 Druid 中，不会存在 Oracle 下 PSCache 占用内存过多的问题，可以把这个数值配置大一些，比如说 100")])]),a("tr",[a("td",[t._v("validationQuery")]),a("td"),a("td",[t._v("用来检测连接是否有效的 sql，要求是一个查询语句。如果 validationQuery 为 null，testOnBorrow、testOnReturn、testWhileIdle 都不会其作用。")])]),a("tr",[a("td",[t._v("validationQueryTimeout")]),a("td"),a("td",[t._v("单位：秒，检测连接是否有效的超时时间。底层调用 jdbc Statement 对象的 void setQueryTimeout(int seconds) 方法")])]),a("tr",[a("td",[t._v("testOnBorrow")]),a("td",[t._v("true")]),a("td",[t._v("申请连接时执行 validationQuery 检测连接是否有效，做了这个配置会降低性能。")])]),a("tr",[a("td",[t._v("testOnReturn")]),a("td",[t._v("false")]),a("td",[t._v("归还连接时执行 validationQuery 检测连接是否有效，做了这个配置会降低性能")])]),a("tr",[a("td",[t._v("testWhileIdle")]),a("td",[t._v("false")]),a("td",[t._v("建议配置为 true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于 timeBetweenEvictionRunsMillis，执行 validationQuery 检测连接是否有效。")])]),a("tr",[a("td",[t._v("timeBetweenEvictionRunsMillis")]),a("td",[t._v("1 分钟（1.0.14）")]),a("td",[t._v("有两个含义： 1) Destroy 线程会检测连接的间隔时间，如果连接空闲时间大于等于 minEvictableIdleTimeMillis 则关闭物理连接 2) testWhileIdle 的判断依据，详细看 testWhileIdle 属性的说明")])]),a("tr",[a("td",[t._v("numTestsPerEvictionRun")]),a("td"),a("td",[t._v("不再使用，一个 DruidDataSource 只支持一个 EvictionRun")])]),a("tr",[a("td",[t._v("minEvictableIdleTimeMillis")]),a("td",[t._v("30 分钟（1.0.14）")]),a("td",[t._v("连接保持空闲而不被驱逐的最长时间")])]),a("tr",[a("td",[t._v("connectionInitSqls")]),a("td"),a("td",[t._v("物理连接初始化的时候执行的 sql")])]),a("tr",[a("td",[t._v("exceptionSorter")]),a("td",[t._v("根据 dbType 自动识别")]),a("td",[t._v("当数据库抛出一些不可恢复的异常时，抛弃连接")])]),a("tr",[a("td",[t._v("filters")]),a("td"),a("td",[t._v("属性类型是字符串，通过别名的方式配置扩展插件，常用的插件有： 监控统计用的 filter:stat 日志用的 filter:log4j 防御 sql 注入的 filter:wall")])]),a("tr",[a("td",[t._v("proxyFilters")]),a("td"),a("td",[t._v("类型是 List<com.alibaba.druid.filter.Filter>，如果同时配置了 filters 和 proxyFilters，是组合关系，并非替换关系")])])])]),t._v(" "),a("h3",{attrs:{id:"_8-2、配置数据源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2、配置数据源"}},[t._v("#")]),t._v(" 8.2、配置数据源")]),t._v(" "),a("p",[t._v("1、添加上 Druid 数据源依赖。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("\x3c!-- https://mvnrepository.com/artifact/com.alibaba/druid --\x3e\n<dependency>\n    <groupId>com.alibaba</groupId>\n    <artifactId>druid</artifactId>\n    <version>1.1.12</version>\n</dependency>\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("2、切换数据源；之前已经说过 Spring Boot 2.0 以上默认使用 com.zaxxer.hikari.HikariDataSource 数据源，但可以 通过 spring.datasource.type 指定数据源。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("spring:\n  datasource:\n    username: root\n    password: 123456\n    url: jdbc:mysql://localhost:3306/springboot?serverTimezone=UTC&useUnicode=true&characterEncoding=utf-8\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    type: com.alibaba.druid.pool.DruidDataSource # 自定义数据源\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("3、数据源切换之后，在测试类中注入 DataSource，然后获取到它，输出一看便知是否成功切换；")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/c750fb675c916db609fe3562ea41a846.png",alt:""}})]),t._v(" "),a("p",[t._v("4、切换成功！既然切换成功，就可以设置数据源连接初始化大小、最大连接数、等待时间、最小连接数 等设置项；可以查看源码")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("spring:\n  datasource:\n    username: root\n    password: 123456\n    #?serverTimezone=UTC解决时区的报错\n    url: jdbc:mysql://localhost:3306/springboot?serverTimezone=UTC&useUnicode=true&characterEncoding=utf-8\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    type: com.alibaba.druid.pool.DruidDataSource\n\n    #Spring Boot 默认是不注入这些属性值的，需要自己绑定\n    #druid 数据源专有配置\n    initialSize: 5\n    minIdle: 5\n    maxActive: 20\n    maxWait: 60000\n    timeBetweenEvictionRunsMillis: 60000\n    minEvictableIdleTimeMillis: 300000\n    validationQuery: SELECT 1 FROM DUAL\n    testWhileIdle: true\n    testOnBorrow: false\n    testOnReturn: false\n    poolPreparedStatements: true\n\n    #配置监控统计拦截的filters，stat:监控统计、log4j：日志记录、wall：防御sql注入\n    #如果允许时报错  java.lang.ClassNotFoundException: org.apache.log4j.Priority\n    #则导入 log4j 依赖即可，Maven 地址：https://mvnrepository.com/artifact/log4j/log4j\n    filters: stat,wall,log4j\n    maxPoolPreparedStatementPerConnectionSize: 20\n    useGlobalDataSourceStat: true\n    connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br")])]),a("p",[t._v("5、导入 Log4j 的依赖")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("\x3c!-- https://mvnrepository.com/artifact/log4j/log4j --\x3e\n        <dependency>\n            <groupId>log4j</groupId>\n            <artifactId>log4j</artifactId>\n            <version>1.2.17</version>\n        </dependency>\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("6、现在需要程序员自己为 DruidDataSource 绑定全局配置文件中的参数，再添加到容器中，而不再使用 Spring Boot 的自动生成了；我们需要 自己添加 DruidDataSource 组件到容器中，并绑定属性；")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('package com.kuang.config;\n\nimport com.alibaba.druid.pool.DruidDataSource;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport javax.sql.DataSource;\n\n@Configuration\npublic class DruidConfig {\n\n    /*\n       将自定义的 Druid数据源添加到容器中，不再让 Spring Boot 自动创建\n       绑定全局配置文件中的 druid 数据源属性到 com.alibaba.druid.pool.DruidDataSource从而让它们生效\n       @ConfigurationProperties(prefix = "spring.datasource")：作用就是将 全局配置文件中\n       前缀为 spring.datasource的属性值注入到 com.alibaba.druid.pool.DruidDataSource 的同名参数中\n     */\n    @ConfigurationProperties(prefix = "spring.datasource")\n    @Bean\n    public DataSource druidDataSource() {\n        return new DruidDataSource();\n    }\n\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br")])]),a("p",[t._v("7、去测试类中测试一下；看是否成功！")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('@SpringBootTest\nclass SpringbootDataJdbcApplicationTests {\n\n    //DI注入数据源\n    @Autowired\n    DataSource dataSource;\n\n    @Test\n    public void contextLoads() throws SQLException {\n        //看一下默认数据源\n        System.out.println(dataSource.getClass());\n        //获得连接\n        Connection connection =   dataSource.getConnection();\n        System.out.println(connection);\n\n        DruidDataSource druidDataSource = (DruidDataSource) dataSource;\n        System.out.println("druidDataSource 数据源最大连接数：" + druidDataSource.getMaxActive());\n        System.out.println("druidDataSource 数据源初始化连接数：" + druidDataSource.getInitialSize());\n\n        //关闭连接\n        connection.close();\n    }\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])]),a("p",[t._v("输出结果 ：可见配置参数已经生效！")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/2c2e4232e457b1876207ebd374d60375.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_8-3、配置-druid-数据源监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-3、配置-druid-数据源监控"}},[t._v("#")]),t._v(" 8.3、配置 Druid 数据源监控")]),t._v(" "),a("p",[t._v("Druid 数据源具有监控的功能，并提供了一个 web 界面方便用户查看，类似安装 路由器 时，人家也提供了一个默认的 web 页面。")]),t._v(" "),a("p",[t._v("所以第一步需要设置 Druid 的后台管理页面，比如 登录账号、密码 等；配置后台管理；")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('//配置 Druid 监控管理后台的Servlet；\n//内置 Servlet 容器时没有web.xml文件，所以使用 Spring Boot 的注册 Servlet 方式\n@Bean\npublic ServletRegistrationBean statViewServlet() {\n    ServletRegistrationBean bean = new ServletRegistrationBean(new StatViewServlet(), "/druid/*");\n\n    // 这些参数可以在 com.alibaba.druid.support.http.StatViewServlet \n    // 的父类 com.alibaba.druid.support.http.ResourceServlet 中找到\n    Map<String, String> initParams = new HashMap<>();\n    initParams.put("loginUsername", "admin"); //后台管理界面的登录账号\n    initParams.put("loginPassword", "123456"); //后台管理界面的登录密码\n\n    //后台允许谁可以访问\n    //initParams.put("allow", "localhost")：表示只有本机可以访问\n    //initParams.put("allow", "")：为空或者为null时，表示允许所有访问\n    initParams.put("allow", "");\n    //deny：Druid 后台拒绝谁访问\n    //initParams.put("kuangshen", "192.168.1.20");表示禁止此ip访问\n\n    //设置初始化参数\n    bean.setInitParameters(initParams);\n    return bean;\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])]),a("p",[t._v("配置完毕后，我们可以选择访问 ：http://localhost:8080/druid/login.html")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/e082fcc2d42ea375beff79a767cc9cc1.png",alt:""}})]),t._v(" "),a("p",[t._v("进入之后")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/6247f8a64457acd4a15e2b0ab6494549.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("配置 Druid web 监控 filter 过滤器")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('//配置 Druid 监控 之  web 监控的 filter\n//WebStatFilter：用于配置Web和Druid数据源之间的管理关联监控统计\n@Bean\npublic FilterRegistrationBean webStatFilter() {\n    FilterRegistrationBean bean = new FilterRegistrationBean();\n    bean.setFilter(new WebStatFilter());\n\n    //exclusions：设置哪些请求进行过滤排除掉，从而不进行统计\n    Map<String, String> initParams = new HashMap<>();\n    initParams.put("exclusions", "*.js,*.css,/druid/*,/jdbc/*");\n    bean.setInitParameters(initParams);\n\n    //"/*" 表示过滤所有请求\n    bean.setUrlPatterns(Arrays.asList("/*"));\n    return bean;\n}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])]),a("p",[t._v("平时在工作中，按需求进行配置即可，主要用作监控。")])])}),[],!1,null,null,null);a.default=e.exports}}]);